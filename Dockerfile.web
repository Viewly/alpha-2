FROM python:3.6.4
MAINTAINER furion <_@furion.me>

# add our code
COPY . /alpha-2

# install node.js
RUN apt-get update && \
    apt-get install -y nodejs npm &&\
    rm -rf /var/lib/apt/lists/*
RUN ln -s /usr/bin/nodejs /usr/bin/node

# compile the dependencies
WORKDIR /alpha-2/src/static
RUN npm install

WORKDIR /alpha-2
RUN pip install -r requirements.txt

# regression fix
RUN pip install -U web3

# build Flask-Assets (scss)
ENV FLASK_APP src/views.py
RUN flask assets build

EXPOSE 5000
CMD ["gunicorn", "-w", "1", "-b", "0.0.0.0:5000", "src.views:app"]
